name: Stoat Advanced Notification
on: [push, pull_request, issues]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Build Notification Content
        id: build_content
        run: |
          # Mesaj iÃ§eriÄŸini hazÄ±rlayalÄ±m
          REPO="${{ github.repository }}"
          ACTOR="${{ github.actor }}"
          EVENT="${{ github.event_name }}"
          
          if [ "$EVENT" == "push" ]; then
            MSG="ðŸš€ **Yeni Push!**\nðŸ‘¤ **Yapan:** $ACTOR\nðŸ“ **Mesaj:** ${{ github.event.head_commit.message }}\nðŸ”— [Commit'i GÃ¶r](https://github.com/$REPO/commit/${{ github.sha }})"
          elif [ "$EVENT" == "pull_request" ]; then
            MSG="ðŸ”€ **Pull Request:** ${{ github.event.pull_request.title }}\nðŸ‘¤ **Yapan:** $ACTOR\nðŸ”— [PR'Ä± GÃ¶r](${{ github.event.pull_request.html_url }})"
          else
            MSG="ðŸ”” **GitHub EtkinliÄŸi:** $EVENT\nðŸ‘¤ **Yapan:** $ACTOR\nðŸ“ **Repo:** $REPO"
          fi
          
          # MesajÄ± bir deÄŸiÅŸkene aktaralÄ±m
          echo "payload={\"content\": \"$MSG\"}" >> $GITHUB_OUTPUT

      - name: Send to Stoat
        run: |
          curl -X POST https://stoat.chat/api/webhooks/01KGQ0D3T3FW9EDDFD21EQZVHP/jnEjItkmdDBM_XynlZsJxQbZ-Y9Wd0Hyt3e-8KH-TQoariGhWPgYrw-_GAfY4uZH/ \
          -H "Content-Type: application/json" \
          -d '${{ steps.build_content.outputs.payload }}'
